{"name":"configureLoadoutsScene","type":"script","scope":"global","author":"Hhi2Yn31CW9rBwFt","img":"icons/svg/dice-target.svg","command":"const currentScene = game.scenes.current\n\nconst loadoutsTileDialog = new Dialog({\n    title: \"Define Loadouts Scene Options\",\n    content:`\n    <form>\n      <div class=\"form-group\">\n        <label>Loadouts Name</label>\n        <input type='text' name='loadoutsName'></input>\n      </div>\n    </form>\n    <div class=\"form-group\">\n        <label for=\"weightSelect\">Preference Weight</label>\n        <select name=\"weightSelect\">\n          <option value=0>0</option>\n          <option value=1>1</option>\n          <option value=2>2</option>\n          <option value=3>3</option>\n          <option value=4>4</option>\n          <option value=5>5</option>\n        </select>\n      </div>`,\n      buttons: {\n        cancel: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Cancel`,\n            callback: function(){ return; }  \n            },\n            apply: {\n                icon: \"<i class='fas fa-check'></i>\",\n                label: `Apply`,\n                callback: html => {setupLoadoutsScene(\n                    html.find('[name=\"loadoutsName\"]').val(),\n                    html.find('[name=\"weightSelect\"]').val()\n                    ) }\n                }\n      },\n      default: 'cancel'\n}).render(true);\n\nasync function setupLoadoutsScene(loadoutsName, loadoutsWeight){\n    currentScene.update({\n        \"flags.loadouts\": {\n            \"isLoadoutsScene\": true,\n            \"name\": loadoutsName,\n            \"weight\": loadoutsWeight\n        }\n    })\n}","ownership":{"default":0,"Hhi2Yn31CW9rBwFt":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.3NnuDk3pjoJOfcRM"}},"_stats":{"systemId":"cyberpunk-red-core","systemVersion":"v0.87.3","coreVersion":"10.291","createdTime":1690039193140,"modifiedTime":1690215615698,"lastModifiedBy":"Hhi2Yn31CW9rBwFt"},"folder":null,"sort":0,"_id":"CjYNaXDYE82G7MmD"}
{"name":"configureLoadoutsTiles","type":"script","scope":"global","author":"Hhi2Yn31CW9rBwFt","img":"icons/svg/dice-target.svg","command":"const loadoutsTileDialog = new Dialog({\n    title: \"Define Loadouts Tile Options\", \n    content:`\n    <form>\n      <div class=\"form-group\">\n        <label>Character Name</label>\n        <input type='text' name='characterName'></input>\n      </div>\n    </form>\n    <div class=\"form-group\">\n        <label for=\"weightSelect\">Preference Weight</label>\n        <select name=\"weightSelect\">\n          <option value=0>0</option>\n          <option value=1>1</option>\n          <option value=2>2</option>\n          <option value=3>3</option>\n          <option value=4>4</option>\n          <option value=5>5</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"typeSelect\">Storage Type</label>\n        <select name=\"typeSelect\">\n          <option value=\"holster\">Holster</option>\n          <option value=\"pocket\">Pocket</option>\n          <option value=\"back/shoulder\">Back/Shoulder</option>\n          <option value=\"backpack\">Backpack</option>\n          <option value=\"duffel\">Duffel</option>\n          <option value=\"stash\">Stash</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label for=\"stateSelect\">Equipped State</label>\n        <select name=\"stateSelect\">\n          <option value=\"carried\">Carried</option>\n          <option value=\"owned\">Owned</option>\n          <option value=\"equipped\">Equipped</option>\n        </select>\n      </div>`,\n      buttons: {\n        cancel: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Cancel`,\n            callback: function(){ return; }  \n            },\n        apply: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: `Apply Changes` ,\n            callback: html => {setupLoadoutsTiles(\n                html.find('[name=\"characterName\"]').val(),\n                html.find('[name=\"weightSelect\"]').val(),\n                html.find('[name=\"typeSelect\"]').val(),\n                html.find('[name=\"stateSelect\"]').val()\n            )}   \n            }\n      },\n      default: 'apply',\n}).render(true);\n\nfunction getCharacterActorId(characterName){\n    let matchingCharacters = game.actors.filter(actor => actor.name == characterName)\n    if(! matchingCharacters.length){\n        ui.notifications.error(\"Loadouts: unable to assign tile - no characters found with name \" + characterName + \". No changes were made to selected tile(s).\")\n        return;\n    } else if(matchingCharacters.length > 1) {\n        ui.notifications.error(\"Loadouts: multiple characters found with name \" + characterName + \". No changes were made to selected tile(s).\")\n        return;\n    } else {\n        return matchingCharacters[0].id;\n    }\n}\n\nasync function setupLoadoutsTiles(characterName, tileWeight, storageType, tileState){\n    characterActorId = getCharacterActorId(characterName)\n    if((characterActorId == null) || (characterActorId == undefined)){\n        return;\n    }\n\n    canvas.tiles.controlled.forEach(tile => tile.document.update({\n        \"flags.loadouts\": {\n            \"owner\": characterActorId,\n            \"weight\": tileWeight,\n            \"type\": storageType,\n            \"state\": tileState\n        }\n    }))\n\n    if(! game.scene.current.flags.loadouts){\n        ui.notifications.warn(\"Loadouts: tile(s) configured, but the current scene is not flagged as a Loadouts scene. Ensure that the configureLoadoutsScene macro is run.\")\n    } else {\n        ui.notifications.info(\"Loadouts: tile(s) configured\")\n    }\n}","ownership":{"default":0,"Hhi2Yn31CW9rBwFt":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.WhtWH3k6FMlt7smH"}},"_stats":{"systemId":"cyberpunk-red-core","systemVersion":"v0.87.4","coreVersion":"10.303","createdTime":1683244512534,"modifiedTime":1690395742831,"lastModifiedBy":"Hhi2Yn31CW9rBwFt"},"folder":null,"sort":0,"_id":"YeOQ7nYq7gZXcSE9"}